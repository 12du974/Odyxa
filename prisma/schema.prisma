generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Project {
  id          String   @id @default(cuid())
  name        String
  url         String
  description String?
  favicon     String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  audits      Audit[]
}

model Audit {
  id             String    @id @default(cuid())
  status         String    @default("QUEUED")
  globalScore    Float?
  scoreBreakdown String?
  summary        String?
  pagesScanned   Int       @default(0)
  totalPages     Int       @default(0)
  issuesFound    Int       @default(0)
  startedAt      DateTime?
  completedAt    DateTime?
  configSnapshot String    @default("{}")
  project        Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectId      String
  pages          PageAudit[]
  issues         Issue[]
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model PageAudit {
  id                 String   @id @default(cuid())
  url                String
  title              String?
  screenshots        String?
  performanceMetrics String?
  pageScore          Float?
  scoreBreakdown     String?
  domSnapshotPath    String?
  statusCode         Int?
  audit              Audit    @relation(fields: [auditId], references: [id], onDelete: Cascade)
  auditId            String
  issues             Issue[]
  createdAt          DateTime @default(now())
}

model Issue {
  id             String   @id @default(cuid())
  title          String
  description    String
  severity       String
  category       String
  framework      String
  criterion      String?
  selector       String?
  boundingBox    String?
  screenshotUrl  String?
  recommendation String
  effortLevel    String   @default("MEDIUM")
  impact         Int      @default(5)
  codeSnippet    String?
  fixSnippet     String?
  audit          Audit    @relation(fields: [auditId], references: [id], onDelete: Cascade)
  auditId        String
  pageAudit      PageAudit? @relation(fields: [pageAuditId], references: [id])
  pageAuditId    String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}
